---  #
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: vikunja
  namespace: default
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: vikunja
      version: 6.1.2
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home
        namespace: flux-system
      interval: 5m
  values:
    image:
      repository: caddy
      tag: 2.4.2-alpine
      pullPolicy: IfNotPresent
    caddy:
      noTls: false
    vikunja:
      config: |-
        service:
          jwtsecret: "myVeryComplexJWTSecret"
    service:
      main:
        ports:
          http:
            port: 8080
    ingress:
      main:
        enabled: false
    additionalContainers:
      api:
        name: api
        image: vikunja/api:0.17.1
        imagePullPolicy: IfNotPresent
        # -- You can declare most Vikunja parameters as environment variables.
        # Please consult https://vikunja.io/docs/config-options/ to see all parameters.
        # Note that parameters that are an array cannot be defined as environment variables (like the OpenID Connect settings). Use the vikunja.config Value for that.
        # @default -- See below
        env: []
          - name: VIKUNJA_SERVICE_JWTSECRET
            value: myVeryComplexJWTSecret
          - name: VIKUNJA_DATABASE_TYPE
            value: "postgres"
          - name: VIKUNJA_DATABASE_HOST
            value: db
          - name: VIKUNJA_DATABASE_DATABASE
            value: vikunja
          - name: VIKUNJA_DATABASE_USER
            value: "vikunja"
          - name: VIKUNJA_DATABASE_PASSWORD
            value: password
        volumeMounts:
          - name: vikunja-config
            mountPath: /etc/vikunja/config.yml
            subPath: Vikunja.yaml
          - name: files
            mountPath: /app/vikunja/files

      frontend:
        name: frontend
        image: vikunja/frontend:0.17.0
        imagePullPolicy: IfNotPresent

    # -- Configure persistence settings for the chart under this key.
    # @default -- See values.yaml
    persistence:
      files:
        enabled: true
        existingClaim:  vikunja-files-pvc
        mountpath: /app/vikunja/files
