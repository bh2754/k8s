---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: &app lidarr
  namespace: organizers
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: app-template
      version: 0.1.1
      sourceRef:
        kind: HelmRepository
        name: bjw-s-charts
        namespace: flux-system
      interval: 1m
  install:
    createNamespace: true
    remediation:
      retries: 5
  upgrade:
    remediation:
      retries: 5
  values:
    image:
      repository: caddy
      tag: 2.5.2-alpine
      pullPolicy: IfNotPresent
    caddy:
      # -- Disable auto tls if behind another loadbalancer or ingress
      noTls: true
    vikunja:
      # -- Provide Vikunja config as YAML string
      config: |-
        service:
          jwtsecret: "myVeryComplexJWTSecret"

    # -- Configures service settings for the chart.
    # @default -- See values.yaml
    service:
      main:
        ports:
          http:
            port: 8080

    ingress:
      # -- Enable and configure ingress settings for the chart under this key.
      # @default -- See values.yaml
      main:
        enabled: false

    additionalContainers:
      api:
        name: api
        image: vikunja/api:0.19.2
        imagePullPolicy: IfNotPresent
        env: []
        volumeMounts:
          - name: vikunja-config
            mountPath: /etc/vikunja/config.yml
            subPath: Vikunja.yaml
      frontend:
        name: frontend
        image: vikunja/frontend:0.17.0
        imagePullPolicy: IfNotPresent
    persistence:
      files:
        enabled: false
        mountpath: /app/vikunja/files
